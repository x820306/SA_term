<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/mycss.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="/js/jquery.url.min.js"></script>
    <script src="/js/jquery.cookie.js"></script>
    <title>Function</title>
    <script type="text/javascript">
      $(document).ready(function(){
        /* check login */
        $.get("/isAuthenticated", function(user){
          if(user != ""){
            $.cookie("username", user.DisplayName, {  path: '/' });
            $("#user_name_span").append(user.DisplayName);  
            $("#login_btn").addClass("hidden");
            $("#mypage_btn").removeClass("hidden");
          }
          else{
            $.cookie("username", null, {  path: '/' });
          }
        }, "json");
        /* search */
        $("#search_btn_nav").click(function(){
          window.open("/page_search.html?lan="+$("#lang_nav").val()+"&cnt="+$("#text_nav").val(), "_self");
        });
      });
    </script>
    <style type="text/css">
      .dv_tag{
        color: red;
        display: inline
      }
      .dv_tag2{
        display: inline
  	  
      }
    </style>
  </head>
  <body>
    <header class="navbar-static-top" id="top" role="banner">
      <nav class="navbar navbar-default" role="navigation">
        <div class="container">
          <!-- Brand and toggle get grouped for better mobile display -->
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar_collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">KEEP CODING</a>
          </div>
          <!-- Collect the nav links, forms, and other content for toggling -->
          <div class="collapse navbar-collapse" id="navbar_collapse">
            <ul class="nav navbar-nav">
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Programming Language<b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="/page_lang.html?Language=Cplusplus">Cplusplus</a></li>
                  <li><a href="/page_lang.html?Language=Java">Java</a></li>
                  <li><a href="/page_lang.html?Language=Php">Php</a></li>
                  <li><a href="/page_lang.html?Language=NodeJS">NodeJS</a></li>
                  <li><a href="/page_lang.html?Language=Csharp">Csharp</a></li>
                  <li><a href="/page_lang.html?Language=JavaScript">JavaScript</a></li>
                </ul>
              </li>
            </ul>
            <div class="col-md-6">
              <form class="navbar-form navbar-left" role="search" action="/page_search.html" method="get">
                <div class="form-group">
                  <div class="input-group">
                    <input type="text" class="form-control" placeholder="Search" id="text_nav" name="cnt"> 
                    <div class="input-group-btn">
                      <select class="form-control" id="lang_nav" name="lan">
                        <option value="Cplusplus">Cplusplus</option>
                        <option value="Java">Java</option>
                        <option value="Php">Php</option>
                        <option value="NodeJS">NodeJS</option>
                        <option value="Csharp">Csharp</option>
                        <option value="JavaScript">JavaScript</option>
                      </select>
                    </div>
                    <div class="input-group-btn">
                      <botton type="submit" class="btn btn-default" id="search_btn_nav"><span class="glyphicon glyphicon-search"></span></botton>
                    </div>
                  </div><!-- /.input-group -->
                </div><!-- /.form-group -->
              </form>
            </div><!-- /.col-md-6 -->
            <ul class="nav navbar-nav navbar-right">
              <li id="login_btn"><a href="#" data-toggle="modal" data-target="#login">Login</a></li>
              <li class="dropdown hidden" id="mypage_btn">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span id="user_name_span"></span><b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="/page_profile.html">Profile</a></li>
                  <li><a href="/logout">Logout</a></li>
                </ul>
              </li>
            </ul>
          </div><!-- /.navbar-collapse -->
        </div><!-- /.container -->
      </nav>
    </header>
    <main role="main">
      <div class="container">
        <div class="row">
          <div class="col-md-9" id="col9">
            <div style="font-size:40pt" id="fN"></div>
            <TABLE width=100%>
              <TR>
                <TD align="right">
                  <div style="font-size:20pt" id="fN2" class="dv_tag">0</div>
                  <div style="font-size:15pt" id="fN3" class="dv_tag2">&nbsp Need</div>
                </TD>
              </TR>
            </TABLE>
            <br>
            <ul class="nav nav-tabs">
              <li class="active"><a href="#tabb1" data-toggle="tab">Introduction</a></li>
              <li><a href="#tabb2" data-toggle="tab">Parameters</a></li>
              <li><a href="#tabb3" data-toggle="tab">Return Value</a></li>
              <li><a href="#tabb4" data-toggle="tab">Compatibility</a></li>
              <li><a href="#tabb5" data-toggle="tab">See Also</a></li>
            </ul>
            <div class="tab-content my-tab-content">
              <div class="tab-pane active" id="tabb1"></div>
              <div class="tab-pane" id="tabb2"></div>
              <div class="tab-pane" id="tabb3"></div>
              <div class="tab-pane" id="tabb4"></div>
              <div class="tab-pane" id="tabb5"></div>
            </div>
            <br>
            <TABLE>
              <TR>
                <TD id="ceBtn">
                  <a><button type="button" style="width: 150px;" class="btn btn-default" onclick="alert('Please login!');">Create Example</button></a> 
                </TD>
                <TD id="neBtn">
                  &nbsp&nbsp&nbsp&nbsp <a><button style="width: 150px;" type="button" class="btn btn-default" onclick="alert('Please login!');">Need Example</button></a>
                </TD>
              </TR>
            </TABLE>
            <br>
          </div>
          <div class="col-md-3">
          </div>
        </div>
      </div>
    </main>
    <footer class="my-footer">
      <div class="container">
        <p>Term Project</p>
      </div>
    </footer>
    <!-- Login Modal -->
    <div class="modal fade" id="login" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-sm">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title" id="myModalLabel">Login</h4>
          </div>
          <div class="modal-body">
            <div class="btn-toolbar">
              <a href="http://127.0.0.1.xip.io:5000/auth/facebook">
                <div class="btn-group">
                  <button type="button" class="btn btn-primary btn-lg"><span class="fa fa-facebook"></span></button>
                  <button type="button" class="btn btn-primary btn-lg">Login with <b>facebook</b></button>
                </div>
              </a>
            </div>
            <br>
            <div class="btn-toolbar">
              <a href="http://127.0.0.1:5000/auth/google">
                <div class="btn-group">
                  <button type="button" class="btn btn-danger btn-lg"><i class="fa fa-google-plus"></i></button>
                  <button type="button" class="btn btn-danger btn-lg">Login with <b>Google+</b></button>
                </div>
              </a>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default btn-lg" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div><!-- Login Modal -->
  <script type="text/javascript">
				
			var id=$.url.param("id");
		    var amount=5;
            var counter=1;
            var lk=[];
			var de=[];
			var co=[];
			var ou=[];
			var atrid=[];
			var exmpID=[];
            var Nnb;
          
			
			function plg()
            {
				alert('Please Login');
			}
			
			function plus2(iid,ck)
            {
				 $.ajax({
                url: '/api/need',
				async: false,
                data:$('#nd').serialize(),
                type:"POST",
                dataType:'text',

                success: function(msg){
				},

                 error:function(){ 
                    alert('submit fail'); 
                 }
               }); 
			   
			    $.ajax(
				 			{   url: '/api/hasneeded?id='+iid+"&user="+ck,
							    async: false,
				     			type: 'GET',
	  				 			dataType: 'json',
                     			success: function(Jdata27) { 
								
								if(Jdata27.hasneeded==true){
									document.getElementById('neBtn').innerHTML='&nbsp&nbsp&nbsp&nbsp <a><button style="width: 150px;" type="button" class="btn btn-default" onclick="minus2(\''+iid+'\',\''+ck+'\');">Not Need Anymore</button></a>';
									
									Nnb++;
									document.getElementById('fN2').innerHTML=Nnb;
									}else
									{
										document.getElementById('neBtn').innerHTML='&nbsp&nbsp&nbsp&nbsp <a><button style="width: 150px;" type="button" class="btn btn-default" onclick="plus2(\''+iid+'\',\''+ck+'\');">Need Example</button></a>';
																				}		
															
                    			 },
                     			error: function() {
                     			}
                 				});
			}
			
			function minus2(iid,ck)
            {
				 $.ajax({
                url: '/api/unneed',
				async: false,
                data:$('#und').serialize(),
                type:"POST",
                dataType:'text',

                success: function(msg){
				},

                 error:function(){ 
                    alert('submit fail'); 
                 }
               }); 
			   
			    $.ajax(
				 			{   url: '/api/hasneeded?id='+iid+"&user="+ck,
							    async: false,
				     			type: 'GET',
	  				 			dataType: 'json',
                     			success: function(Jdata28) { 
								
								if(Jdata28.hasneeded==true){
									document.getElementById('neBtn').innerHTML='&nbsp&nbsp&nbsp&nbsp <a><button style="width: 150px;" type="button" class="btn btn-default" onclick="minus2(\''+iid+'\',\''+ck+'\');">Not Need Anymore</button></a>';
									
									}else
									{
										document.getElementById('neBtn').innerHTML='&nbsp&nbsp&nbsp&nbsp <a><button style="width: 150px;" type="button" class="btn btn-default" onclick="plus2(\''+iid+'\',\''+ck+'\');">Need Example</button></a>';
										
										Nnb--;
									document.getElementById('fN2').innerHTML=Nnb;
																				}		
															
                    			 },
                     			error: function() {
                     			}
                 				});
			}
			
			function lgt()
   			{
	  			 $.cookie('cookie', null);
   			}
			
            function plus(ctt,ck)
            {
              document.getElementById('eid1').value=exmpID[ctt-1];
	
			  
			  $.ajax({
                url: '/example/like',
				async: false,
                data:$('#lik').serialize(),
                type:"POST",
                dataType:'text',

                success: function(msg){
				},

                 error:function(){ 
                    alert('submit fail'); 
                 }
               }); 
			   
			   				 $.ajax(
				 			{   url: '/example/hasliked?id='+exmpID[ctt-1]+"&user="+ck,
							    async: false,
				     			type: 'GET',
	  				 			dataType: 'json',
                     			success: function(Jdata25) { 
								
								if(Jdata25.hasliked==true){
									document.getElementById('l2tag'+ctt).innerHTML='&nbsp&nbsp<button type="button" onclick="minus('+ctt+',\''+ck+'\');" style="font-size:12pt">收回讚</button>';
									
									lk[ctt-1]++;
									document.getElementById('ltag'+ctt).innerHTML=lk[ctt-1];
									
									}else
									{
										document.getElementById('l2tag'+ctt).innerHTML='&nbsp&nbsp<button type="button" onclick="plus('+ctt+',\''+ck+'\');" style="font-size:12pt"><img src="image/like.png" width="21" height="18"></button>';
																				}		
															
                    			 },
                     			error: function() {
                     			}
                 				});
            }
			
			 function minus(ctt,ck)
            {
            	 document.getElementById('eid2').value=exmpID[ctt-1];
	
			  
			  $.ajax({
                url: '/example/unlike',
				async: false,
                data:$('#ulik').serialize(),
                type:"POST",
                dataType:'text',

                success: function(msg){
				},

                 error:function(){ 
                    alert('submit fail'); 
                 }
               }); 
			   
			   	 $.ajax(
				 			{   url: '/example/hasliked?id='+exmpID[ctt-1]+"&user="+ck,
							    async: false,
				     			type: 'GET',
	  				 			dataType: 'json',
                     			success: function(Jdata26) { 
								
								if(Jdata26.hasliked==true){
									document.getElementById('l2tag'+ctt).innerHTML='&nbsp&nbsp<button type="button" onclick="minus('+ctt+',\''+ck+'\');" style="font-size:12pt">收回讚</button>';
									}else
									{
										document.getElementById('l2tag'+ctt).innerHTML='&nbsp&nbsp<button type="button" onclick="plus('+ctt+',\''+ck+'\');" style="font-size:12pt"><img src="image/like.png" width="21" height="18"></button>';
										
										lk[ctt-1]--;
									document.getElementById('ltag'+ctt).innerHTML=lk[ctt-1];
																				}		
															
                    			 },
                     			error: function() {
                     			}
                 				});
			
            }
			

            function keyF(ctt,nameF)
            {
            
            
			  var conToSend=nameF+':<br>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp'+document.getElementById('ipt'+ctt).value+'<br><br>';
			  document.getElementById('cntt').value=conToSend;
			  document.getElementById('cntt2').value=exmpID[ctt-1];
			   
			   $.ajax({
                url: '/discussion/create',
				async: false,
                data:$('#discu').serialize(),
                type:"POST",
                dataType:'text',

                success: function(msg){
                     $.ajax(
				 {   url: '/discussion/show?exampleid='+exmpID[ctt-1],
				     async: false,
 					 type: 'GET',
	  				 dataType: 'json',
                     success: function(Jdata23) { 
					    document.getElementById('dsc'+ctt).innerHTML='';
						for(ctr2=0;ctr2<Jdata23.discussions.length;ctr2++){
							
						$('#dsc'+ctt).append(Jdata23.discussions[ctr2].Content);
						}
						document.getElementById('ipt'+ctt).value='';
						
                     },
                     error: function() {
                          
                     }
                 });
			    
				},

                 error:function(){ 
                    alert('submit fail'); 
                 }
               }); 
			  
            }
			
			$.ajax(
				{ url: '/api/showOne?id='+id,
 					 type: 'GET',
					 async: false,
	  				 dataType: 'json',
                     success: function(Jdata) {
    					var Lan=Jdata.Language;
	                    var Int=Jdata.Introduction;
						var Fun=Jdata.FunctionName;
	                    var Par=Jdata.Parameter;
						var Ret=Jdata.ReturnValue;
	                    var See=Jdata.SeeAlso;
						var Com=Jdata.Compatibility;
						Nnb=Jdata.NeedNumber;
						
						document.getElementById('fN').innerHTML=Fun;
			            document.getElementById('fN2').innerHTML=Nnb;
						document.getElementById('tabb1').innerHTML=Int;
						document.getElementById('tabb2').innerHTML=Par;
						document.getElementById('tabb3').innerHTML=Ret;
						document.getElementById('tabb4').innerHTML=Com;
						document.getElementById('tabb5').innerHTML=See;
						
                     },
                     error: function() {
                          
                     }
                 });
			
			
			$.ajax(
				{ url: 'example/show/?apiid='+id,
 					 type: 'GET',
					 async: false,
	  				 dataType: 'json',
                     success: function(Jdata3) {
						amount=Jdata3.examples.length;
						
						
						for(counter=0;counter<amount;counter++){
							de[counter]=Jdata3.examples[counter].Description;
							co[counter]=Jdata3.examples[counter].Code;
							ou[counter]=Jdata3.examples[counter].Output;
							atrid[counter]=Jdata3.examples[counter].CreatedBy;	
							exmpID[counter]=Jdata3.examples[counter]._id;
							lk[counter]=Jdata3.examples[counter].LikeNumber;
						}
						
						 for(counter=1;counter<=amount;counter++){
							
               $('#col9').append('<br><div style="font-size:20pt"><TABLE width=100%><TR><TD>#'+counter+' '+atrid[counter-1].DisplayName+'</TD><TD align="right" valign="bottom"><div id="ltag'+counter+'" class="dv_tag" style="font-size:14pt">'+lk[counter-1]+' </div><div id="l2tag'+counter+'" class="dv_tag2">&nbsp&nbsp<button type="button" onclick="plg();" style="font-size:12pt"><img src="image/like.png" width="21" height="18"></button></div></TD></TR></TABLE></div>');

              $('#col9').append('<ul class="nav nav-tabs"><li class="active"><a href="#tabb'+counter+'1" data-toggle="tab">Description</a></li><li><a href="#tabb'+counter+'2" data-toggle="tab">Code</a></li><li><a href="#tabb'+counter+'3" data-toggle="tab">Output</a></li><li><a href="#tabb'+counter+'4" data-toggle="tab">Discussion</a></li></ul><div class="tab-content my-tab-content"><div class="tab-pane active" id="tabb'+counter+'1">'+de[counter-1]+'</div><div class="tab-pane" id="tabb'+counter+'2">'+co[counter-1]+'</div><div class="tab-pane" id="tabb'+counter+'3">'+ou[counter-1]+'</div><div class="tab-pane" id="tabb'+counter+'4"><div id="dsc'+counter+'" class="my_discussion"></div><div class="input-group my_discussion_ipt"><input type="text" class="form-control" id="ipt'+counter+'"><span class="input-group-btn" id="span'+counter+'"><button onclick="plg();" class="btn btn-default" type="button">輸入</button></span></div></div></div>');
            }
                     },
                     error: function() {
                          
                     }
                 });
				 
				 
				 
				 for(counter=1;counter<=amount;counter++){
					 
				 $.ajax(
				 {   url: '/discussion/show?exampleid='+exmpID[counter-1],
				     async: false,
 					 type: 'GET',
	  				 dataType: 'json',
                     success: function(Jdata22) { 
						for(ctr=0;ctr<Jdata22.discussions.length;ctr++){
							
						$('#dsc'+counter).append(Jdata22.discussions[ctr].Content);
						}
                     },
                     error: function() {
                          
                     }
                 });

			     }
				 
				 
				//?id=538cac1681a6e4200cf10c0b
				
				
				 
				 $.ajax(
				{ url: '/isAuthenticated',
				     async: false,
 					 type: 'GET',
	  				 dataType: 'json',
                     success: function(Jdata2) {
    					var usrID=Jdata2._id;
						var usrName=Jdata2.DisplayName;
						var tobeEnc='page_ce2.html?apiID='+id;
						
						document.getElementById('ceBtn').innerHTML='<a href="'+tobeEnc+'"><button type="button" style="width: 150px;" class="btn btn-default">Create Example</button></a>';
						

						
						var cok=$.cookie('cookie');
						 if(cok==null){
						 $.cookie('cookie',usrID); 
						 cok=$.cookie('cookie');
						 }
						 
						   $.ajax(
				 			{   url: '/api/hasneeded?id='+id+"&user="+cok,
							    async: false,
				     			type: 'GET',
	  				 			dataType: 'json',
                     			success: function(Jdata26) { 
								
								if(Jdata26.hasneeded==true){
									document.getElementById('neBtn').innerHTML='&nbsp&nbsp&nbsp&nbsp <a><button style="width: 150px;" type="button" class="btn btn-default" onclick="minus2(\''+id+'\',\''+cok+'\');">Not Need Anymore</button></a>';
									}else
									{
										document.getElementById('neBtn').innerHTML='&nbsp&nbsp&nbsp&nbsp <a><button style="width: 150px;" type="button" class="btn btn-default" onclick="plus2(\''+id+'\',\''+cok+'\');">Need Example</button></a>';
																				}		
															
                    			 },
                     			error: function() {
                     			}
                 				});
							
						for(counter=1;counter<=amount;counter++)
						{
							
							  $.ajax(
				 			{   url: '/example/hasliked?id='+exmpID[counter-1]+"&user="+cok,
							    async: false,
				     			type: 'GET',
	  				 			dataType: 'json',
                     			success: function(Jdata24) { 
								
								if(Jdata24.hasliked==true){
									document.getElementById('l2tag'+counter).innerHTML='&nbsp&nbsp<button type="button" onclick="minus('+counter+',\''+cok+'\');" style="font-size:12pt">收回讚</button>';
									}else
									{
										document.getElementById('l2tag'+counter).innerHTML='&nbsp&nbsp<button type="button" onclick="plus('+counter+',\''+cok+'\');" style="font-size:12pt"><img src="image/like.png" width="21" height="18"></button>';
																				}		
															
                    			 },
                     			error: function() {
                     			}
                 				});
							
							
							document.getElementById('span'+counter).innerHTML='<button onclick="keyF('+counter+',\''+usrName+'\');" class="btn btn-default" type="button">輸入</button>';
						
						}
						
						 
						 
						 $('#col9').append('<form name="discussion" id="discu" action="/discussion/create" method="post"><input id="cntt" type="hidden" name="Content" value=""><input id="cntt2" type="hidden" name="ExampleID" value=""><input type="hidden" name="CreatedBy" value="'+cok+'"></form>');
						  $('#col9').append('<form name="like" id="lik" action="/example/like" method="post"><input id="eid1" type="hidden" name="id" value=""><input id="uid1" type="hidden" name="user" value="'+cok+'"></form>');
						  
						   $('#col9').append('<form name="unlike" id="ulik" action="/example/unlike" method="post"><input id="eid2" type="hidden" name="id" value=""><input id="uid2" type="hidden" name="user" value="'+cok+'"></form>');
						   
						   $('#col9').append('<form name="need" id="nd" action="/api/need" method="post"><input id="aid1" type="hidden" name="id" value="'+id+'"><input id="uid3" type="hidden" name="user" value="'+cok+'"></form>');
						  
						   $('#col9').append('<form name="unneed" id="und" action="/api/unneed" method="post"><input id="aid2" type="hidden" name="id" value="'+id+'"><input id="uid4" type="hidden" name="user" value="'+cok+'"></form>');
						 
                     },
                     error: function() {
                     }
                 });
		  </script>
  </body>
</html>


